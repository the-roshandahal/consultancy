{% include 'header.html' %}
<div class="app-content">
    <div class="content-wrapper">
        <div class="example-container">
            <div class="example-content bg-light">
                <div class="page-description d-flex align-items-center">
                    <div class="page-description-content flex-grow-1">
                        <h3>{{student.user.first_name|add:" " }}{{student.user.last_name }} <span class="badge badge-success">{{student.stage}}</span></h3>
                        <span>These details are visible in invoice and receipts.</span>
                    </div>
                    <a href="{% url 'single_statement' id=student.id %}"><button type="button" class="btn btn-dark">View Statement</button></a>
                </div>
                
                <!-- add other contents  -->

                
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <span class="badge ">
                                    <div class="page-description-actions">
                                        {% if student.active == True %}
                                          
                                        <div class="dropdown">
                                            <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                                Action
                                            </a>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#addFile">Add Files</a></li>
                                                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#addNote">Add Note</a></li>
                                                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#updateStage">Update Stage</a></li>
                                                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#closeStudent">Close Student</a></li>
                                                <li>
                                                    <hr class="dropdown-divider">
                                                </li>
                                                <li><a class="dropdown-item" href="{% url 'edit_student' id=student.id %}">Edit Student</a></li>
                                                <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#deleteStudent">Delete Student</a></li>
                                            </ul>
                                        </div>
                                        {% else %}
                                        <a data-bs-toggle="modal" data-bs-target="#reopenStudent"><button type="button" class="btn btn-primary">Reopen Student</button></a>
                                        {% endif %}
                                    </div>
                                </span>
                            </div>
                            <div class="card-body">
                                <div class="example-container">
                                    <div class="example-content">
                                        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active"  id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">General</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Notes & Files</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Activity</button>
                                            </li>
                                        </ul>

                                        <div class="tab-content" id="pills-tabContent">
                                            <div class="tab-pane fade active show" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                                                <div class="row widget widget-list mt-5">
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">person</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                       Student Name
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{student.user.first_name|add:" " }}{{student.user.last_name }}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">place</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        Address
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{student.address}}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">email</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        Email
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{student.user.email}}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">call</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        Contact Number
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{student.contact}}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">create</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        Date Joined
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{student.created}}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="col-4">
                                                        <ul class="widget-list-content list-unstyled">
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <span class="widget-list-item-icon"><i class="material-icons-outlined">create</i></span>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        Assigned Employees
                                                                    </a>
                                                                    {% for employee in student.assigned_to.all %}
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{ employee }}
                                                                    </span>
                                                                    {% empty %}
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        No assigned employees
                                                                    </span>
                                                                    {% endfor %}
                                                                </span>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                    <div class="invoice-list-view mt-5">
                                                        <h4>Invoices</h4>
                                                        <table class="table nowrap w-100 mb-5">
                                                            <thead>
                                                                <tr>
                                                                    <th>Invoice</th>
                                                                    <th>Student</th>
                                                                    <th>Issue Date</th>
                                                                    <th>Due Date</th>
                                                                    <th>Invoice Amount</th>
                                                                    <th>Created By</th>
                                                                    <th>Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for invoices in invoices %}
                                                                <tr>
                                                                    <td>{{invoices.id}}</td>
                                                                    <td>{{invoices.student.user.first_name|add:" " }}{{ invoices.student.user.last_name }}</td>
                                                                    <td>{{invoices.created}}</td>
                                                                    <td>{{invoices.created}}</td>
                                                                    <td>Rs.{{invoices.invoice_amount}}</td>
                                                                    <td>{{invoices.created_by}}</td>
                                                                    {% if 'read_finance' in permissions %}
                                                                    <td>
                                                                        <a  href="{% url 'view_invoice' id=invoices.id %}" class="btn btn-primary"><i class="material-icons">visibility</i></a>
                                                                    </td>
                                                                    {% else %}
                                                                    <td>---</td>
                                                                    {% endif %}
                                                                </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    
                                                    </div>
                                                    <div class="invoice-list-view mt-5">
                                                        <h4>Receipts</h4>
                                                        <table class="table nowrap w-100 mb-5">
                                                            <thead>
                                                                <tr>
                                                                    <th>Receipt</th>
                                                                    <th>Student Name</th>
                                                                    <th>Payment Method</th>
                                                                    <th>Paid Amount</th>
                                                                    <th>Created By</th>
                                                                    <th>Receipt Date</th>
                                                                    <th>Actions</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for receipts in receipts %}
                                                                <tr>
                                                                    <td>{{receipts.id}}</td>
                                                                    <td>{{receipts.student.user.first_name|add:" " }}{{ invoices.student.user.last_name }}</td>
                                                                    <td>{{receipts.payment_method}}</td>
                                                                    <td>Rs.{{receipts.paid_amount}}</td>
                                                                    <td>{{receipts.created_by}}</td>
                                                                    <td>{{receipts.created}}</td>
                                                                    {% if 'read_finance' in permissions %}
                                                                    <td>
                                                                        <a  href="{% url 'view_receipt' id=receipts.id %}" class="btn btn-primary"><i class="material-icons">visibility</i></a>
                                                                    </td>
                                                                    {% else %}
                                                                    <td>---</td>
                                                                    {% endif %}
                                                                </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                                                <div class="row widget widget-list">
                                                    <div class="col-4">
                                                        <h4>Files</h4>
                                                        <ul class="widget-list-content list-unstyled">
                                                            {% for file in files %}
                                                            <li class="widget-list-item widget-list-item-green">
                                                                <a href="{{ file.file.url }}">
                                                                    <span class="widget-list-item-icon"><i class="material-icons-outlined">article</i></span>
                                                                </a>
                                                                <span class="widget-list-item-description">
                                                                    <a href="#" class="widget-list-item-description-title">
                                                                        {{file.title}}
                                                                    </a>
                                                                    <span class="widget-list-item-description-subtitle">
                                                                        {{file.created}}
                                                                    </span>
                                                                </span>
                                                            </li>
                                                            {% endfor %}
                                                            
                                                        </ul>
                                                    </div>
                                                    
                                                </div>
                                                <div class="row">
                                                    <div class="col-xl-12 col-xxl-12">
                                                        <div class="todo-list">
                                                            <h4>Notes</h4>
                                                            <ul class="list-unstyled">
                                                                {% for notes in notes %}
                                                                <li class="todo-item">
                                                                    <div class="todo-item-content">
                                                                        <span class="todo-item-title">{{notes.note_title}}</span>
                                                                        <span class="todo-item-subtitle">{{notes.note}}</span>
                                                                    </div>
                                                                </li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                
                                            </div>








                                            <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                                                {% for logs in logs %}
                                                <nav aria-label="breadcrumb">
                                                    <ol class="breadcrumb breadcrumb-container breadcrumb-container-light bg-primary">
                                                        <li class="breadcrumb-item">{{logs.created}} -- {{logs.changed_by}} {{logs.activity}}</li>
                                                    </ol>
                                                </nav>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteStudent" tabindex="-1" role="dialog" aria-labelledby="deleteStudent" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteStudent">Delete Student</h5>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to delete the student.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<a href="{% url 'delete_student' id=student.id %}"><button type="button" class="btn btn-primary">Delete</button></a>
			</div>
		</div>
	</div>
</div>


<div class="modal fade" id="reopenStudent" tabindex="-1" role="dialog" aria-labelledby="reopenStudent" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="reopenStudent">Reopen Student</h5>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to reopen the student.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<a href="{% url 'reopen_student' id=student.id %}"><button type="button" class="btn btn-primary">Save</button></a>
			</div>
		</div>
	</div>
</div>



<div class="modal fade" id="closeStudent" tabindex="-1" role="dialog" aria-labelledby="closeStudent" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="closeStudent">Close Student</h5>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to close the student.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<a href="{% url 'close_student' id=student.id %}"><button type="button" class="btn btn-primary">Save</button></a>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="updateStage" tabindex="-1" role="dialog" aria-labelledby="updateStage" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<form action="{% url 'update_student_stage' id=student.id %}" method="POST">
				{% csrf_token %}
				<div class="modal-header">
					<h5 class="modal-title" id="updateStage">Update Stage</h5>
                    
				</div>
				<div class="modal-body">
					<div class="col-md-12 mb-3">
						<div class="row">
                            <label for="">Stage</label>
                            {% for stage in stage %}
                            <div class="col-4 mt-2">
                                <label for="">{{stage.stage}}</label>
                                <input type="radio" class="form-check-input lead" id="customCheck1" name="stage" value='{{stage.id}}' {% if stage.id == student.stage.id %}checked{% endif %}>
                            </div>
                            {% endfor %}
                            
                        </div>
                    </div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Save</button>
				</div>
			</form>
		</div>
	</div>
</div>


<div class="modal fade" id="addNote" tabindex="-1" role="dialog" aria-labelledby="addNote" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<form action="{% url 'add_student_note' id=student.id %}" method="POST">
				{% csrf_token %}
				<div class="modal-header">
					<h5 class="modal-title" id="addNote">Add Note</h5>
                    
				</div>
				<div class="modal-body">
					<div class="col-md-12 mb-3">
						<div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="">Note Title</label>
                                <input type="text" class="form-control"  placeholder="Initial" name='note_title'>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="">note Description</label>
                                <input type="text" class="form-control"  placeholder="Initial" name='note'>
                            </div>
                            
                        </div>
                    </div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Save</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" id="addFile" tabindex="-1" role="dialog" aria-labelledby="addFile" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<form action="{% url 'add_student_file' id=student.id %}" method="POST" enctype="multipart/form-data">
				{% csrf_token %}
				<div class="modal-header">
					<h5 class="modal-title" id="addFile">Add File</h5>
                    
				</div>
				<div class="modal-body">
					<div class="col-md-12 mb-3">
						<div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="">File Title</label>
                                <input type="text" class="form-control"  placeholder="Document" name='title'>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="">File</label>
                                <input type="file" class="form-control"  placeholder="Initial" name='file'>
                            </div>
                            
                        </div>
                    </div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Save</button>
				</div>
			</form>
		</div>
	</div>
</div>

{% include 'footer.html' %}